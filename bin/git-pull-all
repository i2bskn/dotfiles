#!/bin/bash

git rev-parse --is-inside-work-tree > /dev/null 2>&1
if [ $? -ne 0 ]; then
  echo "Not a git repository"
  exit 1
fi

git fetch --all --prune
before_branch=$(git branch | grep -e "^[ ]*\*" | sed -e 's/^[ \*]*//g')

for branch in $(git branch -vv | sed -e 's/^[ \* ]*//' | awk '{if ($3 ~ /^\[/) print $1}'); do
  git checkout $branch
  git pull
done

current_branch=$(git branch | grep -e "^[  ]*\*" | sed -e 's/^[ \* ]*//g')
if [ $current_branch != $before_branch ]; then
  git checkout $before_branch
fi
